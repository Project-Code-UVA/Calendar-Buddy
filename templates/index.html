{% extends "base.html" %}

{% block title %}Home Page{% endblock title %}

{% block body %}
<h1>Welcome to Calendar Buddy!</h1>
{% if current_user.is_authenticated %}
    <p>Hello, {{ current_user.name }}! Email: {{ current_user.email }}</p>
    <div>
        <p>Profile picture:</p>
        <img src="{{ current_user.profile_pic }}" alt="Google Profile Picture">
    </div>
    <a class="button" href="/logout">Logout</a>
{% else %}
    <a class="button" href="/login">Google Login</a>
{% endif %}

<h2>Upload new File</h2>
<form method="post" enctype="multipart/form-data">
    <input type="file" name="file" accept=".pdf, .txt, .png, .jpg, .jpeg">
    <input type="submit" value="Upload">
</form>

{% with messages = get_flashed_messages() %}
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}
</section>

<section id="calendar-section" class="section">
    <h2>Calendar</h2>
    <ul>
        {% for file in uploaded_files %}
        {% if file.extractedEvent %}
        <li>
            <strong>{{ file.extractedEvent.title }}</strong> â€”
            {{ file.extractedEvent.date.strftime("%Y-%m-%d") }}
        </li>
        {% endif %}
        {% endfor %}
        {% if not uploaded_files %}
        <li>No events uploaded yet.</li>
        {% endif %}
    </ul>
</section>

<section id="history-section" class="section">
    <h2>Upload History</h2>
    <ul>
        {% for file in uploaded_files %}
        <li>
            {{ file.filename }}
            <a href="{{ url_for('download_file', filename=file.filename) }}" class="btn-link">Download</a>
            <a href="{{ url_for('delete_file', file_id=file.id) }}" class="btn-link">Delete</a>
        </li>
        {% endfor %}
        {% if not uploaded_files %}
        <li>No files uploaded yet.</li>
        {% endif %}
    </ul>
</section>

{% endblock body %}
