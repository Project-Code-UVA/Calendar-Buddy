{% extends "base.html" %} 
<!-- Following the base.html layout -->

{% block title %}
Home page
{% endblock title %}

{% block body %}
<div class="header">
    <h1>Welcome to CalendarBuddy!</h1>
    <h2>Upload event files, extract details automatically, and manage your calendar!</h2>


{% if current_user.is_authenticated %}
    <p class="log">Hello, {{ current_user.name }}! <br>Email: {{ current_user.email }}</p>
    <a class="loginButton" href="/logout">
        <img src="{{ current_user.profile_pic }}" alt="" class="button-icon">Logout
    </a>
{% else %}
    <a class="loginButton" href="/login">
        <img src="{{ url_for('static', filename='images/icons8-user-24.png') }}" alt="" class="button-icon">Google Login 
    </a>
{% endif %}
 <a class="home" href="{{ url_for('home_page') }}">
       <img src="{{ url_for('static', filename='images/icons8-user-24.png') }}" alt="" class="button-icon">Home
    </a> 

</div>

<div class="uploadSection">
<h3>Upload New File</h3>
<h4>Upload images or files containing event information. We'll analyze them to extract event details.</h4>
<div class="buttonSection">
    <img src="{{ url_for('static', filename='images/icons8-upload-48.png') }}" alt="" class="uploadIcon">

    <form method="post" enctype="multipart/form-data">
        <input id="file" type="file" class="file" name="file" accept=".pdf, .txt, .png, .jpg, .jpeg">
        <label for="file" class="file-label">Select File</label>
        <div id="file-name" class="file-name">No file selected</div>
        <br>
        <input type="submit" class= "upload" value="Upload">
    </form>
</div>
</div>


{% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class = output>
        <h3>Output:</h3>
        <ul>
        {% for message in messages %}
        <li class="list">{{ message }}</li>
        {% endfor %}
        <br>

        </ul>

    {% endif %}
    {% endwith %}

    {% if filename and file_ready %}
    <table border="1" cellpadding="5">
        <thead>
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Time</th>
                <th>Location</th>
            </tr>
        </thead>
        <tbody>
            {% for event in event_json %}
            <tr>
                <td>{{ event["name"] }}</td>
                <td>{{ event["start"].strftime("%Y-%m-%d") }}</td>
                <td>{{ event["start"].strftime("%H:%m") }} to {{ event["end"].strftime("%H:%m") }} </td>
                <td>{{ event["loc"] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <a href="{{url_for('download_file', filename=filename)}}"
       class="download"> 
       Download {{ filename }}
     </a>

     {% if current_user.is_authenticated %}
     <table border="1" cellpadding="5">
        <thead>
            <tr>
                <th>File Name</th>
                <th>File ID</th>
                <th>Download ICS</th>
            </tr>
        </thead>
        <tbody>
            
        </tbody>
     </table>

     {% endif %}

   {% endif %}
    </div>
    
<script>
document.getElementById("file").addEventListener("change", function() {
    let display = document.getElementById("file-name");
    if (!display) {
        // Create the display element if it doesn't exist yet
        display = document.createElement("span");
        display.id = "file-name";
        display.style.marginLeft = "10px";
        this.insertAdjacentElement('afterend', display);
    }
    display.textContent = this.files.length > 0 ? this.files[0].name : "No file chosen";
});
</script>


{% endblock body %}